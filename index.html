<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turing-Pass Dynamic Quiz</title>
    <style>
        /* (ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼, í€´ì¦ˆ ì˜ì—­ë§Œ ì‚´ì§ ìˆ˜ì •) */
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; padding: 0; background-color: #121212; font-family: -apple-system, BlinkMacSystemFont, "Pretendard", sans-serif; color: black; overflow: hidden; height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; }
        
        #app-container { display: flex; gap: 60px; align-items: center; justify-content: center; transform-origin: center center; padding: 20px; }

        /* ì¢Œì¸¡ íŒ¨ë„ */
        .control-panel { width: 320px; height: 720px; padding: 25px; background: #2c2c2e; border-radius: 30px; border: 1px solid #444; color: white; box-shadow: 0 20px 50px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .control-header { font-size: 22px; font-weight: 800; margin-bottom: 20px; border-bottom: 2px solid #007AFF; padding-bottom: 15px; color: #fff; }
        .section-label { font-size: 11px; color: #8e8e93; margin-top: 15px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        button { width: 100%; padding: 14px 16px; border: none; border-radius: 12px; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 8px; text-align: left; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.96); }
        .btn-blue { background: #0A84FF; color: white; }
        .btn-warn { background: #FF9F0A; color: white; }
        .btn-danger { background: #FF453A; color: white; }
        .btn-gray { background: #3a3a3c; color: #aeaeb2; }
        .log-box { flex: 1; margin-top: 20px; background: #000; color: #30d158; padding: 15px; font-size: 11px; overflow-y: auto; border-radius: 15px; font-family: 'Menlo', monospace; line-height: 1.6; border: 1px solid #333; }

        /* ìš°ì¸¡ ì•„ì´í° */
        .iphone { width: 375px; height: 812px; background: white; border-radius: 50px; border: 12px solid #1c1c1e; position: relative; box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8); overflow: hidden; }
        .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 160px; height: 32px; background: #1c1c1e; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; z-index: 100; }
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; background: #F2F2F7; padding-top: 50px; }
        .screen.active { display: flex; }

        /* í™”ë©´ 1 */
        #screen-setup { align-items: center; padding: 40px 25px; text-align: center; }
        .title { font-size: 28px; font-weight: 800; margin-bottom: 10px; color: #1c1c1e; }
        .subtitle { font-size: 15px; color: #8e8e93; margin-bottom: 40px; line-height: 1.4; }
        .age-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; margin-bottom: 30px; }
        .age-opt { padding: 18px; background: white; border-radius: 18px; font-size: 15px; font-weight: 700; color: #1c1c1e; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 2px solid transparent; transition: 0.2s; }
        .age-opt.selected { border-color: #007AFF; background: #E1F0FF; color: #007AFF; }
        .typing-box { background: white; padding: 20px; border-radius: 20px; width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .typing-target { font-size: 18px; font-weight: 700; color: #1c1c1e; margin-bottom: 15px; }
        .typing-input { width: 100%; padding: 14px; border: 2px solid #e5e5ea; border-radius: 12px; font-size: 16px; outline: none; text-align: center; font-weight: 600; }
        .typing-input:focus { border-color: #007AFF; }
        .setup-btn { background: #007AFF; color: white; width: 100%; padding: 18px; border-radius: 18px; border: none; font-size: 17px; font-weight: 700; margin-top: auto; cursor: pointer; opacity: 0.5; pointer-events: none; transition: 0.3s; }
        .setup-btn.ready { opacity: 1; pointer-events: all; box-shadow: 0 10px 20px rgba(0,122,255,0.3); }

        /* í™”ë©´ 2 */
        #screen-main { background: white; }
        .app-bar { height: 50px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; margin-bottom: 10px; }
        .logo { font-size: 20px; font-weight: 800; color: #002B5B; }
        .card-balance { margin: 0 20px; padding: 30px 25px; background: #002B5B; border-radius: 28px; color: white; box-shadow: 0 10px 30px rgba(0,43,91,0.3); }
        .shield-tag { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); }
        .balance-num { font-size: 32px; font-weight: 700; letter-spacing: -0.5px; }
        .info-list { margin: 30px 25px; }
        .list-header { font-size: 11px; font-weight: 800; color: #8e8e93; margin-bottom: 10px; letter-spacing: 1px; }
        .info-row { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #f2f2f7; font-size: 14px; color: #1c1c1e; }
        .info-val { font-weight: 700; color: #007AFF; }

        /* í™”ë©´ 3 */
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 59, 48, 0.98); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: 0.4s; z-index: 200; padding: 40px; text-align: center; }
        .iphone.risk-active .overlay { opacity: 1; pointer-events: all; }
        .alert-icon { font-size: 70px; margin-bottom: 20px; text-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .alert-title { font-size: 28px; font-weight: 800; margin-bottom: 15px; }
        .alert-desc { font-size: 16px; line-height: 1.5; opacity: 0.95; margin-bottom: 50px; }
        .btn-verify { background: white; color: #FF3B30; padding: 18px 40px; border-radius: 30px; font-weight: 700; font-size: 16px; border: none; cursor: pointer; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 100%; }

        /* í™”ë©´ 4 (í€´ì¦ˆ) */
        #screen-quiz { background: #F2F2F7; align-items: center; padding: 40px 25px; text-align: center; }
        .quiz-card { background: white; width: 100%; padding: 35px 25px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); margin-top: 60px; }
        .quiz-q { font-size: 20px; font-weight: 700; color: #1c1c1e; margin-bottom: 25px; line-height: 1.4; word-break: keep-all; }
        .quiz-input { width: 100%; padding: 16px; border: 2px solid #e5e5ea; border-radius: 14px; font-size: 17px; margin-bottom: 25px; text-align: center; outline: none; }
        .quiz-input:focus { border-color: #34C759; }
        .btn-submit { background: #34C759; color: white; width: 100%; padding: 18px; border-radius: 16px; font-weight: 700; font-size: 17px; border: none; cursor: pointer; box-shadow: 0 5px 15px rgba(52, 199, 89, 0.3); }
        .quiz-msg { margin-top: 25px; font-size: 14px; font-weight: 700; height: 20px; }

        .timer-box { width: 140px; height: 140px; border-radius: 50%; border: 5px solid rgba(255,255,255,0.3); display: flex; justify-content: center; align-items: center; font-size: 36px; font-weight: 700; margin-bottom: 30px; border-top-color: white; animation: spin 2s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-2deg); } 75% { transform: translateX(5px) rotate(2deg); } }
        .iphone.shaking { animation: shake 0.4s infinite; }
    </style>
</head>
<body>

<div id="app-container" class="container">
    
    <div class="control-panel">
        <div class="control-header">ğŸ›ï¸ Turing-Pass Admin</div>
        <div class="section-label">Step 1. ì‹œìŠ¤í…œ</div>
        <button class="btn-gray" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨ (Reset)</button>
        <div class="section-label">Step 2. ìœ„í˜‘ ì‹œë‚˜ë¦¬ì˜¤</div>
        <button class="btn-blue" onclick="simulateSafe()">âœ… ì •ìƒ ì´ì²´ (Safe)</button>
        <button class="btn-warn" onclick="simulateRisk('pingpong')">âš ï¸ ì•± ì „í™˜ ê³¼ë‹¤ (Ping-Pong)</button>
        <button class="btn-danger" onclick="simulateRisk('voice')">ğŸ“ í†µí™” ê°ì§€ (Voice)</button>
        <button class="btn-danger" onclick="simulateRisk('delay')">ğŸ¢ ë¹„ì •ìƒ ì§€ì—° (Deviation)</button>
        <button class="btn-danger" onclick="simulateRisk('tremor')">ğŸ‘‹ ë¯¸ì„¸ ë–¨ë¦¼ (Tremor)</button>
        <div class="log-box" id="logBox">
            > System Ready.<br>> Waiting for user setup...
        </div>
    </div>

    <div class="iphone" id="phone">
        <div class="notch"></div>

        <div class="screen active" id="screen-setup">
            <div style="flex:1"></div>
            <div class="title">Turing-Pass</div>
            <div class="subtitle">ë§ì¶¤í˜• ë³´ì•ˆì„ ìœ„í•´<br>í”„ë¡œí•„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
            <div class="age-grid">
                <div class="age-opt" onclick="selectAge(10, this)">10ëŒ€</div>
                <div class="age-opt selected" onclick="selectAge(20, this)">2030</div>
                <div class="age-opt" onclick="selectAge(40, this)">4050</div>
                <div class="age-opt" onclick="selectAge(60, this)">60ëŒ€+</div>
            </div>
            <div class="typing-box">
                <div class="typing-target">í‘¸ë¥¸ í•˜ëŠ˜ ì€í•˜ìˆ˜</div>
                <input type="text" class="typing-input" id="realInput" placeholder="ë”°ë¼ ì…ë ¥í•˜ì„¸ìš”" oninput="handleTyping(this)">
                <div id="liveSpeed" style="margin-top:10px; font-size:12px; color:#007AFF; font-weight:700;">í˜„ì¬ ì†ë„: 0 ms</div>
            </div>
            <div style="flex:1"></div>
            <button class="setup-btn" id="btnStart" onclick="completeSetup()">ì¸¡ì • ì™„ë£Œ ë° ì‹œì‘</button>
        </div>

        <div class="screen" id="screen-main">
            <div class="app-bar"><span class="logo">IM Bank</span><span style="font-size:20px;">ğŸ‘¤</span></div>
            <div class="card-balance">
                <div class="shield-tag">ğŸ›¡ï¸ Turing-Pass ON</div>
                <div style="font-size:13px; opacity:0.8; margin-bottom:5px;">ë‚´ ê³„ì¢Œ ì”ì•¡</div>
                <div class="balance-num">350,000ì›</div>
            </div>
            <div class="info-list">
                <div class="list-header">USER PROFILE</div>
                <div class="info-row"><span>ì—°ë ¹ ê·¸ë£¹</span><span class="info-val" id="dispAge">-</span></div>
                <div class="info-row"><span>ê¸°ì¤€ ì†ë„ (Base)</span><span class="info-val" id="dispBase">- ms</span></div>
                <div class="info-row"><span>ë¯¼ê°ë„ (Weight)</span><span class="info-val" id="dispWeight">-</span></div>
            </div>
            <div class="info-list" style="margin-top:0;">
                <div class="list-header" style="color:#FF3B30;">REAL-TIME DATA</div>
                <div class="info-row"><span>ì†ë„ í¸ì°¨ (Dev)</span><span class="info-val" id="curDev" style="color:#FF3B30">-</span></div>
                <div class="info-row"><span>ìœ„í—˜ ì ìˆ˜ (R_score)</span><span class="info-val" id="curScore" style="color:#FF3B30">-</span></div>
            </div>
        </div>

        <div class="overlay" id="overlay">
            <div class="alert-icon" id="riskIcon">âš ï¸</div>
            <div class="timer-box" id="timerBox" style="display:none;">3:00</div>
            <div class="alert-title" id="riskTitle">ìœ„í—˜ ê°ì§€</div>
            <div class="alert-desc" id="riskDesc">ì„¤ëª…</div>
            <button class="btn-verify" onclick="goQuiz()">ë³¸ì¸ í™•ì¸ (Quiz)</button>
        </div>

        <div class="screen" id="screen-quiz">
            <div class="quiz-card">
                <div style="font-size:40px; margin-bottom:20px;">ğŸ”’</div>
                <div class="quiz-q" id="quizQuestion">ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                <input type="text" class="quiz-input" id="quizInput" placeholder="ì •ë‹µ ì…ë ¥">
                <button class="btn-submit" onclick="checkQuiz()">í™•ì¸</button>
                <div class="quiz-msg" id="quizMsg"></div>
            </div>
        </div>
    </div>
</div>

<script>
    /* ========== ìë™ ìŠ¤ì¼€ì¼ ì¡°ì • ========== */
    function resizeApp() {
        const container = document.getElementById('app-container');
        const height = window.innerHeight;
        const width = window.innerWidth;
        let scale = 1;
        if (height < 900 || width < 1000) { scale = Math.min(width / 1000, height / 900); }
        container.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', resizeApp);
    window.addEventListener('load', resizeApp);

    /* ========== ë¡œì§ ========== */
    let userAge = 20;
    let baseline = 0;
    let ageWeight = 1.0;
    let startTime = 0;
    
    // í˜„ì¬ í€´ì¦ˆ ìƒíƒœ ì €ì¥
    let currentQuiz = { q: "", a: "" };

    const logBox = document.getElementById('logBox');
    const phone = document.getElementById('phone');

    function log(msg) {
        const time = new Date().toLocaleTimeString('en-US', {hour12:false, minute:'2-digit', second:'2-digit'});
        logBox.innerHTML = `[${time}] ${msg}<br>` + logBox.innerHTML;
    }

    function selectAge(age, elem) {
        userAge = age;
        document.querySelectorAll('.age-opt').forEach(e => e.classList.remove('selected'));
        elem.classList.add('selected');
    }

    function handleTyping(input) {
        const val = input.value;
        if(val.length === 1 && startTime === 0) startTime = new Date().getTime();
        if(val.length > 1) {
            const speed = Math.round((new Date().getTime() - startTime) / val.length);
            document.getElementById('liveSpeed').innerText = `í˜„ì¬ ì†ë„: ${speed} ms`;
        }
        if(val.length >= 7) {
            document.getElementById('btnStart').classList.add('ready');
            baseline = Math.round((new Date().getTime() - startTime) / val.length);
        }
    }

    function completeSetup() {
        if(baseline === 0) baseline = 200; 
        if(userAge === 10) ageWeight = 1.3;
        else if(userAge === 20) ageWeight = 1.5; 
        else if(userAge === 40) ageWeight = 1.0; 
        else ageWeight = 0.8;

        document.getElementById('screen-setup').classList.remove('active');
        document.getElementById('screen-main').classList.add('active');
        
        let ageLabel = userAge === 60 ? "60ëŒ€+" : (userAge === 40 ? "4050" : (userAge === 10 ? "10ëŒ€" : "2030"));
        document.getElementById('dispAge').innerText = ageLabel;
        document.getElementById('dispBase').innerText = baseline + " ms";
        document.getElementById('dispWeight').innerText = "x" + ageWeight;
        
        log(`Setup: ${ageLabel}, Base ${baseline}ms`);
    }

    function simulateSafe() {
        phone.classList.remove('risk-active');
        phone.classList.remove('shaking');
        document.getElementById('curDev').innerText = "0 ms";
        document.getElementById('curScore').innerText = "10 (Safe)";
        log("âœ… Action: Normal Flow");
    }

    // ìƒí™©ë³„ í€´ì¦ˆ ë° ìœ„í—˜ ì„¤ì • í•¨ìˆ˜
    function simulateRisk(type) {
        phone.classList.remove('risk-active');
        phone.classList.remove('shaking');

        if(type === 'pingpong') {
            log("âš ï¸ Detect: Ping-Pong Pattern");
            // ë©”ì‹ ì € í”¼ì‹± -> ì ê¸ˆ ë³„ëª… ì§ˆë¬¸
            activateRisk("â³", "ì´ì²´ 3ë¶„ ì§€ì—°", "ì¦ì€ ì•± ì „í™˜ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë©”ì‹ ì € í”¼ì‹± ì˜ˆë°©ì„ ìœ„í•´ ëŒ€ê¸°í•˜ì„¸ìš”.", true, 
                "ìµœê·¼ ê°€ì…í•œ ì˜ˆê¸ˆ ìƒí’ˆì˜<br>ë³„ëª…ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", "ë‚´ì§‘ë§ˆë ¨");
        } 
        else if(type === 'voice') {
            log("ğŸ“ Detect: Voice Call");
            // ë³´ì´ìŠ¤í”¼ì‹± -> ì–´ë¨¸ë‹ˆ ì„±í•¨ ì§ˆë¬¸
            activateRisk("ğŸ“", "í†µí™” ì¤‘ ì°¨ë‹¨", "í†µí™” ì—°ê²°ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©ì„ ìœ„í•´ ì¢…ë£Œí•˜ì„¸ìš”.", false,
                "ì–´ë¨¸ë‹ˆì˜ ì„±í•¨ì€<br>ë¬´ì—‡ì…ë‹ˆê¹Œ?", "ê¹€ì˜í¬");
        }
        else if(type === 'delay') {
            let deviation = 600;
            let score = Math.round(deviation * 0.1 * ageWeight);
            document.getElementById('curDev').innerText = `+${deviation} ms`;
            document.getElementById('curScore').innerText = score;
            log(`ğŸ¢ Deviation +${deviation}ms (Score ${score})`);

            if(score >= 50) {
                setTimeout(() => {
                    // ì…ë ¥ ì§€ì—° -> ì´ˆë“±í•™êµ ì§ˆë¬¸
                    activateRisk("ğŸ¢", "ë¹„ì •ìƒ ì§€ì—°", `í‰ì†Œë³´ë‹¤ ${deviation}ms ëŠë¦½ë‹ˆë‹¤.<br>ê°•ì••ì  ìƒí™©ì´ ì˜ì‹¬ë©ë‹ˆë‹¤.`, false,
                        "ì¡¸ì—…í•œ ì´ˆë“±í•™êµì˜<br>ì´ë¦„ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", "ì„œìš¸");
                }, 300);
            } else {
                log("âœ… Pass: Acceptable for this Age.");
            }
        }
        else if(type === 'tremor') {
            log("ğŸ‘‹ Detect: Micro-Tremor");
            phone.classList.add('shaking');
            // ë¯¸ì„¸ ë–¨ë¦¼ -> ê³„ì¢Œ ë³„ëª… ì§ˆë¬¸
            activateRisk("ğŸ‘‹", "ë¯¸ì„¸ ë–¨ë¦¼ ê°ì§€", "ê³µí¬ ë°˜ì‘(8-12Hz)ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ë³¸ì¸ í™•ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤.", false,
                "ìì£¼ ì“°ëŠ” ê³„ì¢Œì˜<br>ë³„ëª…ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?", "ìƒí™œë¹„");
        }
    }

    function activateRisk(icon, title, desc, timer, question, answer) {
        document.getElementById('riskIcon').innerText = icon;
        document.getElementById('riskTitle').innerText = title;
        document.getElementById('riskDesc').innerHTML = desc;
        
        // í€´ì¦ˆ ì •ë³´ ì €ì¥
        currentQuiz.q = question;
        currentQuiz.a = answer;

        const tBox = document.getElementById('timerBox');
        const rIcon = document.getElementById('riskIcon');
        
        if(timer) { tBox.style.display = 'flex'; rIcon.style.display = 'none'; } 
        else { tBox.style.display = 'none'; rIcon.style.display = 'block'; }

        phone.classList.add('risk-active');
    }

    function goQuiz() {
        phone.classList.remove('risk-active');
        phone.classList.remove('shaking');
        document.getElementById('screen-main').classList.remove('active');
        document.getElementById('screen-quiz').classList.add('active');
        
        // ì €ì¥ëœ í€´ì¦ˆ í‘œì‹œ
        document.getElementById('quizQuestion').innerHTML = currentQuiz.q;
        document.getElementById('quizInput').value = ""; // ì´ˆê¸°í™”
        document.getElementById('quizMsg').innerText = "";
        
        log(`ğŸ”’ Challenge: ${currentQuiz.a}`);
    }

    function checkQuiz() {
        const ans = document.getElementById('quizInput').value;
        const msg = document.getElementById('quizMsg');
        
        // ì •ë‹µ ì²´í¬ (í¬í•¨ ì—¬ë¶€ í™•ì¸)
        if(ans.includes(currentQuiz.a) || ans.length > 1) { // ì‹œì—° í¸ì˜ìƒ 2ê¸€ì ì´ìƒì´ë©´ í†µê³¼ ì²˜ë¦¬ ê°€ëŠ¥
            msg.style.color = "#34C759"; msg.innerText = "ë³¸ì¸ í™•ì¸ ì™„ë£Œ. ì•ˆì „í•˜ê²Œ ë³µê·€í•©ë‹ˆë‹¤.";
            log("ğŸ”“ Verified.");
            setTimeout(() => {
                document.getElementById('screen-quiz').classList.remove('active');
                document.getElementById('screen-main').classList.add('active');
                simulateSafe();
            }, 1500);
        } else {
            msg.style.color = "#FF3B30"; msg.innerText = "ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
        }
    }
</script>
</body>
</html>